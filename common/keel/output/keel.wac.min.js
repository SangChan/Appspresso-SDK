(function(u){var s=!!u._APPSPRESSO_DEBUG;var m={};var d=0;var r=1;var c=r;function v(){return c}function e(g){c=g}function f(){}function b(w,g){if(!w){throw new Error("assertion failed:"+g)}}function i(){if(d===c){var g=m.util.format.apply(null,arguments);console.log(g)}}function q(){if(s){var g=m.util.format.apply(null,arguments);console.log("[internal] "+g)}}function k(g){return(g!==undefined)&&(typeof g==="object")}function a(g){return Object.prototype.toString.call(g)==="[object Function]"}function n(g){return(typeof g==="string")||(g instanceof String)}function p(g){return(g!==undefined)&&(typeof g==="number")&&(!isNaN(g))}function j(g){return(g!==undefined)&&(typeof g==="boolean")}function l(g){return(g!==undefined)&&(g instanceof Array)}function h(g){return(g!==undefined)&&!n(g)&&!a(g)&&((g instanceof Array)||isFinite(g.length))}function t(g){this.target=g||{}}t.prototype.constant=function(g,w){if(!n(g)){throw new Error("invalid parameter: name")}this.target.__defineGetter__(g,function(){return w});return this};t.prototype.property=function(w,g,x){if(!n(w)){throw new Error("invalid parameter: name")}if(g){if(!a(g)){throw new Error("invalid parameter: getter")}this.target.__defineGetter__(w,g)}if(x){if(!a(x)){throw new Error("invalid parameter: setter")}this.target.__defineSetter__(w,x)}return this};t.prototype.method=function(g,w){if(!n(g)){throw new Error("invalid parameter: name")}if(!a(w)){throw new Error("invalid parameter: func")}this.target.__defineGetter__(g,function(){return w});return this};t.prototype.ns=function(g,y){var x,w,z=g.split(".");if(!y){y=u}for(x=0;x<z.length-1;x+=1){w=z[x];if(!y.hasOwnProperty(w)){y[w]={}}y=y[w]}w=z[x];y[w]=this.target;return this};t.prototype.mixin=function(x){if(x){var w,g;for(w in x){if(x.hasOwnProperty(w)){g=x[w];if(!this.target.hasOwnProperty(w)||(this.target[w]!==g)){this.target[w]=g}}}}return this};t.prototype.end=function(){return this.target};function o(g){return new t(g)}o(m).constant("MODE_DEBUG",d).constant("MODE_RELEASE",r).property("runMode",v,e).method("nop",f).method("assert",b).method("log",i).method("debug",q).method("isObject",k).method("isFunction",a).method("isString",n).method("isNumber",p).method("isBoolean",j).method("isArray",l).method("isArrayLike",h).method("def",o);o(u).constant("ax",m)}(window));(function(g){var _DEBUG=!!g._APPSPRESSO_DEBUG;var ax=g.ax;var util={};function evaluateJavaScript(script){if(script===""){return}var ret=eval("("+script+")");return ret}function decodeJSON(json){if(json===undefined||json===null||json===""){ax.debug("[W] decodeJSON(): json is null/undefined/empty");return{}}try{return evaluateJavaScript(json)}catch(e){ax.debug("[E] decodeJSON(): eval error {0}",e);throw ax.error(ax.INVALID_VALUES_ERR,e)}}function encodeJSON(obj){return JSON.stringify(obj)}function parseXML(xml){return new DOMParser().parseFromString(xml,"text/xml")}function foreach(obj,callback){if(!obj){return null}if(!callback){return null}var k,v;if(ax.isArrayLike(obj)){for(k=0;k<obj.length;k++){v=obj[k];if(callback(k,v)){return k}}}else{for(k in obj){if(obj.hasOwnProperty(k)){v=obj[k];if(callback(k,v)){return k}}}}return null}var DUMP_MAX_DEPTH=3;var DUMP_INDENT="\t";var DUMP_NEWLINE="\n";var DUMP_UNDEFINED="<<undefined>>";var DUMP_ARRAY="<<array>>";var DUMP_ARRAY_LIKE="<<array-like>>";var DUMP_FUNCTION="<<function>>";var DUMP_OBJECT="<<object>>";var DUMP_NULL="<<null>>";function dump(obj,depth,indent,newline,separator){if(typeof obj==="undefined"){return DUMP_UNDEFINED}if(obj===null){return DUMP_NULL}if(typeof obj==="string"){return['"',obj,'"'].join("")}if(typeof obj==="number"||typeof obj==="number"){return String(obj)}var props=[];if(!ax.isNumber(depth)){depth=DUMP_MAX_DEPTH}if(!ax.isString(indent)){indent=DUMP_INDENT}if(!ax.isString(newline)){newline=DUMP_NEWLINE}if(!ax.isString(separator)){separator=[",",newline,indent].join("")}if(ax.isArrayLike(obj)){if(depth<=0){if(ax.isArray(obj)){return DUMP_ARRAY}return DUMP_ARRAY_LIKE}foreach(obj,function(k,v){props.push(dump(v,depth-1,indent+indent))});return["[",newline,indent,props.join(separator),newline,"]"].join("")}if(typeof obj==="function"){return DUMP_FUNCTION}if(typeof obj==="object"){if(depth<=0){return DUMP_OBJECT}foreach(obj,function(k,v){props.push([k,dump(v,depth-1,indent+indent)].join(":"))});return["{",newline,indent,props.join(separator),newline,"}"].join("")}return obj.toString()}var AJAX_RETRY_DEFAULT=3;function ajax(args){var xhr=new XMLHttpRequest(),debug_time,retry=args.retry!==undefined?args.retry:(getConfig("ajaxRetry")||AJAX_RETRY_DEFAULT);xhr.onreadystatechange=function(){if(_DEBUG){}if(xhr.readyState===4){if(_DEBUG){ax.debug("ajax xhr.onreadystatechange: xhr.status={0}, elapse={1}ms",xhr.status,(new Date().getTime()-debug_time))}if(xhr.status===0){if((g.location.protocol==="file:")&&(args.url.indexOf("://")<0)){return args.onload(xhr)}if(retry){ax.debug("##### AJAX RETRY!!! ##### - "+retry);args.retry=--retry;return ajax(args)}}if(xhr.status>=200&&xhr.status<300){return args.onload(xhr)}else{return args.onerror(xhr)}}};if(_DEBUG){ax.debug("ajax: {0}",JSON.stringify(args));debug_time=new Date().getTime()}try{xhr.open(args.method||"GET",args.url,!!args.async);foreach(args.headers,function(k,v){xhr.setRequestHeader(k,v)});xhr.send(args.data)}catch(e){args.onerror(xhr,e)}return xhr}function format(text){if(arguments.length<2){return String(text)}var args=Array.prototype.slice.call(arguments,[1]);ax.util.foreach(args,function(k,v){text=text.replace(new RegExp("\\{"+k+"\\}","gi"),v)});return text}var INVALID_FUNCTION="<<invalid-function>>";var ANONYMOUS_FUNCTION="<<anonymous-function>>";var FUNCTION_REGEXP=/function\s+(\w+)/;function getFunctionName(func){if(!ax.isFunction(func)){return INVALID_FUNCTION}var match=FUNCTION_REGEXP.exec(func);return match?match[1]:ANONYMOUS_FUNCTION}function invokeLater(obj,func){var args=Array.prototype.slice.call(arguments,2);window.setTimeout(function(){try{func.apply(obj,args)}catch(e){ax.log("uncaught exception from function {1}: {0} ",e,getFunctionName(func))}},1)}function validateParam(param,mandatory,nullable,type,exception,name){var msg;if(undefined===param){if(mandatory){msg=format("{0}: mandatory parameter is omitted",name);ax.log(msg);if(exception){throw new ax.error(ax.INVALID_VALUES_ERR,msg)}return false}}else{if(null===param){if(!nullable){msg=format("{0}: parameter can not be null",name);ax.log(msg);if(exception){throw new ax.error(ax.INVALID_VALUES_ERR,msg)}return false}}else{if(typeof param!==type){if(type==="string"){return true}else{if(type==="number"){if(!isNaN(parseFloat(param))&&isFinite(param)){return true}}}msg=format("{0}: must be a {1} type",name,type);ax.log(msg);if(exception){throw new ax.error(ax.TYPE_MISMATCH_ERR,msg)}return false}}}return true}function validateInstance(value,constructor,exception,name){if(value&&!(value instanceof constructor)){if(exception){throw new ax.error(ax.TYPE_MISMATCH_ERR,name+": is not a "+getFunctionName(constructor))}return false}return true}var topics={};function subscribe(topic,callback){if(!topics[topic]){topics[topic]=[]}topics[topic].push(callback)}function unsubscribe(topic,callback){foreach(topics[topic],function(k,v){if(v===callback){topics[topic].splice(k,1);return true}})}function publish(topic,args){foreach(topics[topic],function(k,v){invokeLater(null,v,args)})}var INVALID_PATH_REGEX=/\/\/|\.\.|\.\/|^$|^\.$/;function isValidPath(){for(var i=0;i<arguments.length;i++){if(INVALID_PATH_REGEX.test(arguments[i])){return false}}return true}var configs={};function getConfig(key){return configs[key]}function setConfig(key,value){configs[key]=value}ax.def(util).method("evaluateJavaScript",evaluateJavaScript).method("encodeJSON",encodeJSON).method("decodeJSON",decodeJSON).method("parseXML",parseXML).method("foreach",foreach).method("dump",dump).method("ajax",ajax).method("format",format).method("getFunctionName",getFunctionName).method("invokeLater",invokeLater).method("validateParam",validateParam).method("validateInstance",validateInstance).method("subscribe",subscribe).method("unsubscribe",unsubscribe).method("publish",publish).method("isValidPath",isValidPath).method("getConfig",getConfig).method("setConfig",setConfig);ax.def(ax).constant("util",util)}(window));